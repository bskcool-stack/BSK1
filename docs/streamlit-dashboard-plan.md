# Streamlit 지하철 혼잡도 대시보드 구현 계획 (Phase 단위)

대상 데이터: `서울교통공사_지하철혼잡도정보_20250930.csv`  
목표: 역/노선/방향(상·하행) 및 시간대별 혼잡도를 **빠르게 탐색**하고, 혼잡 TOP/피크 시간/추천 시간대를 제공하는 **Streamlit 대시보드** 구축

---

## 0) 전제: 데이터 구조 요약

현재 CSV는 대략 아래 형태입니다.

- **식별 컬럼**: 노선(예: 1호선/2호선), 역번호, 역명, 방향(상행/하행 또는 내선/외선에 준하는 구분), (추정)요일/구분값
- **시간대 컬럼**: `05:30` ~ `00:30` (30분 단위) 다수 컬럼
- **값**: 시간대별 혼잡도 (수치, 보통 %로 해석 가능)

주의: 파일을 그대로 읽으면 **한글 컬럼명이 깨져 보일 수 있어 인코딩 처리**가 필요합니다.

---

## 1) MVP 범위(최소 기능) 정의 (Phase 0)

### 목표
- “처음 열었을 때 전체 상황을 요약”하고
- “노선/역을 골라 시간대 패턴을 빠르게 확인”하고
- “시간대×노선(또는 역) 히트맵으로 한눈에 비교”하는 것

### MVP 화면(3페이지)
- **요약(Overview)**: 선택 조건(요일/방향/시간대)에 대한 혼잡 TOP 10 + 노선별 평균
- **역 상세(Station Detail)**: 선택 역의 시간대별 추이 + 상/하행(방향) 비교
- **히트맵(Heatmap)**: 시간대 × 노선(또는 역)의 혼잡도 히트맵

### 공통 필터(사이드바)
- 노선, 역, 방향(상/하행), 요일/구분값(데이터에 존재하는 경우), 시간대 범위

### 혼잡도 등급(색상구간) 예시
- 여유: < 30
- 보통: 30 ~ 60
- 혼잡: 60 ~ 90
- 매우혼잡: ≥ 90

> 등급 기준은 운영 목적에 맞게 Phase 0에서 최종 확정합니다.

---

## 2) Phase 1 — 데이터 로딩/정리 파이프라인 (권장 1일)

### 산출물
- “원본 CSV → 정규화된 Long 포맷” 변환 결과(저장)
- 데이터 품질 체크 규칙 및 처리 방침 문서화

### 작업 목록
- **인코딩 처리**
  - 우선순위: `cp949`/`euc-kr`로 읽기 → 실패 시 다른 인코딩 fallback
  - 내부 처리 및 저장은 UTF-8로 통일
- **컬럼 정리**
  - 식별 컬럼(노선/역명/방향/요일 등)과 시간대 컬럼을 분리
  - 시간대 컬럼명을 표준 포맷(예: `05:30`)으로 통일
- **Wide → Long 변환**
  - `time_slot`(시간대), `congestion`(혼잡도) 컬럼으로 변환
- **정합성 체크**
  - 값 범위 검증(예: 음수/비정상 값)
  - 결측/0값 처리 규칙(“진짜 0인지, 결측 대체인지”)
  - 역명 표기 흔들림 정리(공백/특수문자)

---

## 3) Phase 2 — 집계/캐시 레이어 (권장 0.5~1일)

### 목표
Streamlit에서 매번 큰 변환을 하지 않도록, **미리 집계된 테이블**을 만들고 캐시합니다.

### 산출물(추천)
- 정규화 데이터: `data/processed/congestion_long.parquet`
- 집계 테이블:
  - 노선 × 시간대 평균
  - 역 × 시간대 평균
  - TOP N(혼잡/여유), 피크 시간대

### 성능 전략
- Streamlit: `st.cache_data`로
  - 파일 로딩 결과 캐시
  - 필터 적용/집계 결과 캐시
- 시각화는 “집계 테이블 기반”으로 렌더링

---

## 4) Phase 3 — Streamlit MVP UI 구현 (권장 2~3일)

### 페이지 1: 요약(Overview)
- KPI/요약:
  - 선택한 시간대(또는 시간대 범위)에서 **혼잡 TOP 10 역**
  - **노선별 평균 혼잡도** 막대그래프
- 테이블:
  - 역명/노선/방향/혼잡도/등급(색상) 표기

### 페이지 2: 역 상세(Station Detail)
- 라인차트:
  - 선택 역의 시간대별 혼잡도 추이
- 비교:
  - 상/하행(방향) 비교(가능하면 동일 그래프에 2개 라인)
- 인사이트:
  - 최저 혼잡 시간대, 피크 시간대, 평균/변동성

### 페이지 3: 히트맵(Heatmap)
- (시간대 × 노선) 히트맵(권장: MVP에 가장 안정적)
  - 역 단위 히트맵은 행이 너무 많아질 수 있어 성능/가독성 고려
- 색상구간/범례 제공

---

## 5) Phase 4 — 고도화 기능 (권장 2~5일)

### 기능 후보(우선순위 순)
- **추천**: “이 역에서 가장 덜 혼잡한 시간대 TOP 3”
- **비교 모드**: 역 2개 / 노선 2개 비교
- **다운로드**: 필터 적용 결과 CSV 다운로드
- **탐색 UX 강화**: 즐겨찾기(자주 보는 역), 빠른 검색, 툴팁/설명 강화

---

## 6) Phase 5 — 배포/운영 (권장 0.5~2일)

### 배포 옵션
- Streamlit Community Cloud (개인/학습용에 간편)
- Docker/사내 서버 배포(과제/서비스형에 적합)

### 운영 체크리스트
- requirements 고정
- 데이터 업데이트 절차(새 CSV 들어오면 변환/집계 재생성)
- 로깅/에러 핸들링(파일 인코딩/컬럼 변동 대비)

---

## 7) 권장 프로젝트 구조(안)

아래는 “작게 시작해서 커질 때도 안 깨지는” 최소 구조 예시입니다.

- `app.py` : Streamlit 진입점(페이지 라우팅/공통 필터)
- `src/`
  - `io.py` : CSV 로딩/인코딩 처리
  - `transform.py` : wide→long 변환, 정합성 체크
  - `metrics.py` : 집계/지표 계산
  - `viz.py` : 차트 생성 함수
- `data/`
  - `raw/` : 원본 CSV
  - `processed/` : parquet/cached outputs
- `docs/` : 계획/데이터 사전/사용법 문서

---

## 8) 다음 결정(질문 3개)

MVP를 바로 코딩하려면 아래 3가지만 확정하면 됩니다.

1. **요일/구분값**(예: 평일/토/일)이 실제로 어떤 값/의미인지: 그대로 필터로 노출할지?
2. **방향 컬럼**(상행/하행)이 화면에서 “상/하행”으로 고정 표기해도 되는지?
3. 히트맵은 MVP에서 **(시간대×노선)** 으로 갈지, **(시간대×역)** 도 꼭 필요한지?


